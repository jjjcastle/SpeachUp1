<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Speech up</title>
  <link rel="stylesheet" href="/static/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    #videoWrapper {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 12px;
    }
    #videoStream {
      width: 320px;
      height: auto;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgba(94, 44, 165, 0.15);
    }
    #randomQuestionBox {
      background-color: #eee6f9;
      padding: 14px;
      border-radius: 12px;
      margin-top: 12px;
      font-size: 16px;
      font-weight: 500;
      color: #2c1e4a;
      animation: slideDownFade 0.5s ease;
    }

    @keyframes slideDownFade {
      from {
        opacity: 0;
        transform: translateY(-15px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <h1>Speech Up</h1>

  <div class="container">
    <!-- ì™¼ìª½ ì˜ì—­ -->
    <div class="left-panel">
      <label for="sessionIdInput">ID</label>
      <input type="text" id="sessionIdInput" placeholder="ì„¸ì…˜ ID (0~99)" />

      <div>
        <h2>ì§ˆë¬¸</h2>
        <button onclick="pickRandomQuestion()">ì§ˆë¬¸ ë½‘ê¸°</button>
        <div id="randomQuestionBox"><strong>ì„ íƒëœ ì§ˆë¬¸:</strong> <span id="randomQuestion">-</span></div>

        <div id="videoWrapper">
          <button id="toggleVideoBtn">ì¹´ë©”ë¼ ì‹œì‘ & ìŒì„± ë…¹ìŒ</button>
          <div id="videoSection" style="display: none;">
            <img id="videoStream" src="" alt="Video Stream">
          </div>
        </div>
      </div>

      <div class="result-section">
        <button onclick="processVideo()">ë¶„ì„</button>

        <div id="loadingSpinner" style="display: none; text-align: center; margin: 20px 0;">
          <div class="spinner"></div>
          <div class="loading-text">ë¡œë”© ì¤‘...</div>
        </div>

        <h2>ğŸ¤ìŒì„± ë¶„ì„ ê²°ê³¼</h2>
        <span id="voiceResult">-</span>

        <h2>ğŸ“ ì–¸ì–´ ë¶„ì„ ê²°ê³¼</h2>
        <span id="transcriptText">-</span>

        <h2>ğŸ˜„ í‘œì • ë¶„ì„ ê²°ê³¼</h2>
        <span id="visionResult">-</span>

        <h2>â˜€ï¸  ìµœì¢… í”¼ë“œë°± ê²°ê³¼</h2>
        <span id="finalFeedBack">-</span>

      </div>
    </div>
  </div>

<script>
  const SERVER_URL = "http://127.0.0.1:8000";
  const toggleBtn = document.getElementById("toggleVideoBtn");
  const videoStreamImg = document.getElementById("videoStream");
  const videoSection = document.getElementById("videoSection");
  const randomQuestionBox = document.getElementById("randomQuestionBox");
  const questionSpan = document.getElementById("randomQuestion");
  let isStreaming = false;

  toggleBtn.onclick = async () => {
    const sessionIdInput = document.getElementById("sessionIdInput");
    let sessionId = sessionIdInput.value.trim();
    const formData = new FormData();
    if (sessionId !== "") formData.append("session_id", sessionId);

    if (!isStreaming) {
      const res = await fetch(SERVER_URL + "/start-video", {
        method: "POST",
        body: formData
      });
      const data = await res.json();
      sessionId = data.session_id;
      sessionIdInput.value = sessionId;

      videoStreamImg.src = SERVER_URL + "/video_feed";
      toggleBtn.textContent = "ì¹´ë©”ë¼ & ìŒì„± ì •ì§€";
      videoSection.style.display = "block";
      isStreaming = true;
    } else {
      const formDataStop = new FormData();
      formDataStop.append("session_id", sessionId);

      await fetch(SERVER_URL + "/stop-video", {
        method: "POST",
        body: formDataStop
      });

      videoStreamImg.src = "";
      toggleBtn.textContent = "ì¹´ë©”ë¼ ì‹œì‘ & ìŒì„± ë…¹ìŒ";
      videoSection.style.display = "none";
      isStreaming = false;
    }
  };

  function pickRandomQuestion() {
    const questions = [
      "Why do you want to work at our company?",
      "What is your greatest strength and how has it helped you in your work or studies?",
      "Where do you see yourself in five years, and how does this position align with your long-term goals?"
    ];
    const randomIndex = Math.floor(Math.random() * questions.length);
    questionSpan.textContent = questions[randomIndex];
    randomQuestionBox.style.animation = 'none';
    randomQuestionBox.offsetHeight; // reflow ê°•ì œ
    randomQuestionBox.style.animation = null;
  }

  async function processVideo() {
    const sessionId = document.getElementById("sessionIdInput").value.trim();
    const formData = new FormData();
    formData.append("session_id", sessionId);

    const res = await fetch(SERVER_URL + "/process-video", {
      method: "POST",
      body: formData
    });

    const data = await res.json();
    console.log("ì²˜ë¦¬ ê²°ê³¼:", data);

    if (data.result) {
      document.getElementById("visionResult").textContent = data.result;
    } else {
      alert(data.error || "ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }

    if (data.transcript) {
      document.getElementById("transcriptText").textContent = data.transcript;
    } else {
      document.getElementById("transcriptText").textContent = "(ì „ì‚¬ ì‹¤íŒ¨)";
    }
  }
</script>
</body>
</html>
